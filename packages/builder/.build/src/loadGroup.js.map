{"version":3,"sources":["src/loadGroup.ts"],"sourcesContent":["import glob from \"fast-glob\";\nimport path from \"path\";\nimport loadFunction from \"./loadFunction\";\n\n// Load a group of functions from the same directory.\nexport default function loadGroup({\n  dirname,\n  envVars,\n  group,\n  watch,\n}: {\n  dirname: string;\n  envVars: Record<string, string>;\n  group: string;\n  watch: boolean;\n}): Map<string, ReturnType<typeof loadFunction>> {\n  const filenames = listFilenames(path.resolve(dirname, \"background\", group));\n  return filenames.reduce(\n    (map, filename) =>\n      map.set(\n        path.basename(filename, path.extname(filename)),\n        loadFunction({ envVars, filename, watch })\n      ),\n    new Map()\n  );\n}\n\nfunction isValidFunctionName(filename: string) {\n  const basename = path.basename(filename, path.extname(filename));\n  return /^[a-zA-Z0-9_-]+$/.test(basename);\n}\n\nfunction listFilenames(dirname: string): string[] {\n  const filenames = glob.sync(\"[!_]*.{js,ts}\", {\n    cwd: dirname,\n    followSymbolicLinks: true,\n    onlyFiles: true,\n  });\n  const invalid = filenames.filter(\n    (filename) => !isValidFunctionName(filename)\n  );\n  if (invalid.length > 0) {\n    const filenames = invalid.map((filename) => `'${filename}''`).join(\", \");\n    throw new Error(\n      `Filename can only contain alphanumeric, hyphen, or underscore: ${filenames}`\n    );\n  }\n  return filenames.map((filename) => path.resolve(dirname, filename));\n}\n"],"names":["loadGroup","dirname","envVars","group","watch","filenames","listFilenames","resolve","reduce","map","filename","set","basename","extname","Map","isValidFunctionName","test","sync","cwd","followSymbolicLinks","onlyFiles","invalid","filter","length","join","Error"],"mappings":";;;;kBAKwBA,SAAS;AALhB,GAAW,CAAX,SAAW;AACX,GAAM,CAAN,KAAM;AACE,GAAgB,CAAhB,aAAgB;SAGjBA,SAAS,CAAC,CAAC,CACjCC,OAAO,GACPC,OAAO,GACPC,KAAK,GACLC,KAAK,EAMP,CAAC,EAAgD,CAAC;IAChD,KAAK,CAACC,SAAS,GAAGC,aAAa,CAfhB,KAAM,SAegBC,OAAO,CAACN,OAAO,EAAE,CAAY,aAAEE,KAAK;IACzE,MAAM,CAACE,SAAS,CAACG,MAAM,EACpBC,GAAG,EAAEC,QAAQ,GACZD,GAAG,CAACE,GAAG,CAlBI,KAAM,SAmBVC,QAAQ,CAACF,QAAQ,EAnBb,KAAM,SAmBcG,OAAO,CAACH,QAAQ,QAlB5B,aAAgB,UAmBpB,CAAC;YAACR,OAAO;YAAEQ,QAAQ;YAAEN,KAAK;QAAC,CAAC;MAE7C,GAAG,CAACU,GAAG;AAEX,CAAC;SAEQC,mBAAmB,CAACL,QAAgB,EAAE,CAAC;IAC9C,KAAK,CAACE,QAAQ,GA3BC,KAAM,SA2BCA,QAAQ,CADHF,QAAgB,EA1B5B,KAAM,SA2ByBG,OAAO,CAD1BH,QAAgB;IAE3C,MAAM,oBAAoBM,IAAI,CAACJ,QAAQ;AACzC,CAAC;SAEQN,aAAa,CAACL,OAAe,EAAY,CAAC;IACjD,KAAK,CAACI,SAAS,GAjCA,SAAW,SAiCHY,IAAI,CAAC,CAAe,gBAAE,CAAC;QAC5CC,GAAG,EAAEjB,OAAO;QACZkB,mBAAmB,EAAE,IAAI;QACzBC,SAAS,EAAE,IAAI;IACjB,CAAC;IACD,KAAK,CAACC,OAAO,GAAGhB,SAAS,CAACiB,MAAM,EAC7BZ,QAAQ,IAAMK,mBAAmB,CAACL,QAAQ;;IAE7C,EAAE,EAAEW,OAAO,CAACE,MAAM,GAAG,CAAC,EAAE,CAAC;QACvB,KAAK,CAAClB,SAAS,GAAGgB,OAAO,CAACZ,GAAG,EAAEC,QAAQ,IAAM,CAAC,EAAEA,QAAQ,CAAC,EAAE;UAAGc,IAAI,CAAC,CAAI;QACvE,KAAK,CAAC,GAAG,CAACC,KAAK,EACZ,+DAA+D,EAAEpB,SAAS;IAE/E,CAAC;IACD,MAAM,CAACA,SAAS,CAACI,GAAG,EAAEC,QAAQ,GA9Cf,KAAM,SA8CmBH,OAAO,CAACN,OAAO,EAAES,QAAQ;;AACnE,CAAC"}
{"version":3,"sources":["/Users/assaf/Projects/queue.run/packages/services/queues/deploy.fifo.ts"],"sourcesContent":["import { deployProject } from \"@queue-run/builder\";\nimport { deployInSequence } from \"../lib/deploy/inSequence\";\nimport withSourceDir from \"../lib/deploy/withSourceDir\";\n\nexport default async function deployJob(\n  { deployId }: { deployId: string },\n  { params, signal }: { params: { projectId: string }; signal: AbortSignal }\n) {\n  console.log({ params });\n  await deployInSequence(\n    { deployId, signal },\n    async ({ archive, deploy, signal }) =>\n      withSourceDir(\n        { archive, signal },\n        async (sourceDir) =>\n          await deployProject({\n            config: {\n              project: deploy.projectId,\n              branch: deploy.branchId,\n            },\n            signal,\n            sourceDir,\n          })\n      )\n  );\n}\n\nexport const config = {\n  url: \"/project/:group/deploy/\",\n  accepts: \"application/json\",\n};\n"],"names":["deployJob","deployId","params","signal","console","log","archive","deploy","sourceDir","config","project","projectId","branch","branchId","url","accepts"],"mappings":";;;;kBAI8BA,SAAS;;AAJT,GAAoB,CAApB,QAAoB;AACjB,GAA0B,CAA1B,WAA0B;AACjC,GAA6B,CAA7B,cAA6B;;;;;;eAEzBA,SAAS,CACrC,CAAC,CAACC,QAAQ,EAAuB,CAAC,EAClC,CAAC,CAACC,MAAM,GAAEC,MAAM,EAANA,OAAM,EAAyD,CAAC,EAC1E,CAAC;IACDC,OAAO,CAACC,GAAG,CAAC,CAAC;QAACH,MAAM;IAAC,CAAC;IACtB,KAAK,KAR0B,WAA0B,mBASvD,CAAC;QAACD,QAAQ;QAAEE,MAAM,EAANA,OAAM;IAAC,CAAC,SACb,CAAC,CAACG,OAAO,GAAEC,MAAM,GAAEJ,MAAM,EAAC,CAAC,OATZ,cAA6B,UAW/C,CAAC;YAACG,OAAO;YAAEH,MAAM;QAAC,CAAC,SACZK,SAAS,GACd,KAAK,KAfe,QAAoB,gBAepB,CAAC;gBACnBC,MAAM,EAAE,CAAC;oBACPC,OAAO,EAAEH,MAAM,CAACI,SAAS;oBACzBC,MAAM,EAAEL,MAAM,CAACM,QAAQ;gBACzB,CAAC;gBACDV,MAAM;gBACNK,SAAS;YACX,CAAC;;;AAGX,CAAC;AAEM,KAAK,CAACC,MAAM,GAAG,CAAC;IACrBK,GAAG,EAAE,CAAyB;IAC9BC,OAAO,EAAE,CAAkB;AAC7B,CAAC;QAHYN,MAAM,GAANA,MAAM"}
{"version":3,"sources":["src/dev/pushMessage.ts"],"sourcesContent":["import { readFile } from \"fs/promises\";\nimport fetch from \"node-fetch\";\nimport { URL } from \"url\";\n\nexport default async function pushMessage(\n  queueName: string,\n  message: string,\n  { port, group }: { port: number; group?: string }\n) {\n  const body = await getMessageBody(message);\n  const path = queueName.endsWith(\".fifo\")\n    ? `/queue/${queueName}/${group ?? \"group-x\"}`\n    : `/queue/${queueName}`;\n  const url = new URL(path, `http://localhost:${port}`);\n  const response = await fetch(url.href, { method: \"POST\", body });\n  if (!response.ok)\n    throw new Error(`${response.status}: ${await response.text()}`);\n  const { messageId } = await response.json();\n  console.info(\"Queued message %s\", messageId);\n}\n\nasync function getMessageBody(message: string): Promise<string> {\n  if (message === \"-\") return await readFile(\"/dev/stdin\", \"utf8\");\n  else if (message.startsWith(\"@\"))\n    return await readFile(message.slice(1), \"utf-8\");\n  else return message;\n}\n"],"names":["pushMessage","queueName","message","port","group","body","getMessageBody","path","endsWith","url","response","href","method","ok","Error","status","text","messageId","json","console","info","startsWith","slice"],"mappings":";;;;kBAI8BA,WAAW;AAJhB,GAAa,CAAb,SAAa;AACpB,GAAY,CAAZ,UAAY;AACV,GAAK,CAAL,IAAK;eAEKA,WAAW,CACvCC,SAAiB,EACjBC,OAAe,EACf,CAAC,CAACC,IAAI,GAAEC,KAAK,EAAmC,CAAC,EACjD,CAAC;IACD,KAAK,CAACC,IAAI,GAAG,KAAK,CAACC,cAAc,CAACJ,OAAO;IACzC,KAAK,CAACK,IAAI,GAAGN,SAAS,CAACO,QAAQ,CAAC,CAAO,WAClC,OAAO,EAAEP,SAAS,CAAC,CAAC,EAAEG,KAAK,aAALA,KAAK,cAALA,KAAK,GAAI,CAAS,cACxC,OAAO,EAAEH,SAAS;IACvB,KAAK,CAACQ,GAAG,GAAG,GAAG,CAXG,IAAK,KAWHF,IAAI,GAAG,iBAAiB,EAAEJ,IAAI;IAClD,KAAK,CAACO,QAAQ,GAAG,KAAK,KAbN,UAAY,UAaCD,GAAG,CAACE,IAAI,EAAE,CAAC;QAACC,MAAM,EAAE,CAAM;QAAEP,IAAI;IAAC,CAAC;IAC/D,EAAE,GAAGK,QAAQ,CAACG,EAAE,EACd,KAAK,CAAC,GAAG,CAACC,KAAK,IAAIJ,QAAQ,CAACK,MAAM,CAAC,EAAE,EAAE,KAAK,CAACL,QAAQ,CAACM,IAAI;IAC5D,KAAK,CAAC,CAAC,CAACC,SAAS,EAAC,CAAC,GAAG,KAAK,CAACP,QAAQ,CAACQ,IAAI;IACzCC,OAAO,CAACC,IAAI,CAAC,CAAmB,oBAAEH,SAAS;AAC7C,CAAC;eAEcX,cAAc,CAACJ,OAAe,EAAmB,CAAC;IAC/D,EAAE,EAAEA,OAAO,KAAK,CAAG,IAAE,MAAM,CAAC,KAAK,KAtBV,SAAa,WAsBO,CAAY,aAAE,CAAM;SAC1D,EAAE,EAAEA,OAAO,CAACmB,UAAU,CAAC,CAAG,KAC7B,MAAM,CAAC,KAAK,KAxBS,SAAa,WAwBZnB,OAAO,CAACoB,KAAK,CAAC,CAAC,GAAG,CAAO;SAC5C,MAAM,CAACpB,OAAO;AACrB,CAAC"}